<div class="task-page">
  <h1><%= '‚úÖ ' if @free_task.completed_by?(current_user) %><%= @free_task.label %></h1>

  <p>
    <%= admin_only do %>
      <%= link_to '–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π', edit_free_task_path(@free_task), class: :action %>
    <% end %>

    <%= authenticated_only do %>
      <% if @incomplete_solution %>
        –ü—Ä–µ–¥–∞–π —Ä–µ—à–µ–Ω–∏–µ: <code class="solution-token">vim-fmi free <%= @incomplete_solution.token %></code>

        <%= link_to 'üìã', '#', {
          class: ['clipboard-btn', :action],
          data: { success: '‚úÖ' },
        } %>

        <%= link_to '‚ùå', free_task_solution_path(@free_task, @incomplete_solution), {
          method: :delete,
          class:  [:action],
        } %>
      <% else %>
        <%= link_to '–ü—Ä–µ–¥–∞–π —Ä–µ—à–µ–Ω–∏–µ', free_task_solutions_path(@free_task), {
          method: :post,
          class:  [:action, :primary],
        } %>
      <% end %>
    <% end %>
  </p>

  <% if admin? or @free_task.completed_by?(current_user) %>
    <p><%= link_to '–î—Ä—É–≥–∏ —Ä–µ—à–µ–Ω–∏—è', free_task_solutions_path(@free_task) %></p>
  <% end %>

  <dl>
    <dt>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:</dt>
    <dd><%= link_to 'Guide', free_task_guide_path %></dd>
  </dl>

  <p>
    <% if @free_task.description? %>
      <p><%=markup @free_task.description %></p>
    <% end %>

    <table class="input-output-table">
      <tr>
        <th>–ù–∞—á–∞–ª–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ</th>
        <th>–ö—Ä–∞–π–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ</th>
      </tr>

      <tr>
        <td><%= render 'shared/formatted_code', code: @free_task.formatted_input %></td>
        <td><%= render 'shared/formatted_code', code: @free_task.formatted_output %></td>
      </tr>
    </table>
  </p>

  <% if @completed_solutions %>
    <%# link_to '–ö–æ–º–µ–Ω—Ç–∞—Ä–∏ –∫—ä–º –º–æ–µ—Ç–æ —Ä–µ—à–µ–Ω–∏–µ', @current_user_solution, class: [:action, :primary] %>

    <p>
      <h3>–¢–≤–æ–∏—Ç–µ —Ä–µ—à–µ–Ω–∏—è</h3>

      <table class="solutions">
        <thead>
          <tr>
            <th class="warnings">:/</th>
            <th class="vimrc">Vimrc</th>
            <th class="script">–†–µ—à–µ–Ω–∏–µ</th>
            <th class="key-count">#</th>
            <th class="timestamp">–ü—É—Å–Ω–∞—Ç–æ</th>
            <th class="time-spent">–í—Ä–µ–º–µ</th>
          </tr>
        </thead>

        <tbody>
          <% @completed_solutions.each do |solution| %>
            <tr>
              <td class="warnings">
                <%= render 'solutions/warnings', solution: solution %>
              </td>
              <td class="vimrc">
                <%= solution.vimrc_revision_id? ? '‚úÖ': '' %>
              </td>
              <td class="script">
                <code><%= render 'shared/script', script_keys: solution.compact_script_keys %></code>
              </td>
              <td class="key-count">
                <%= link_to solution.script_keys.count, free_task_solution_path(@free_task, solution) %>
              </td>
              <td class="timestamp">
                <%= I18n.l solution.completed_at %>
              </td>
              <td class="time-spent">
                <%= (solution.completed_at - solution.created_at).round(2) %>s
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </p>
  <% end %>

  <% admin_only do %>
    <p>
      <%= link_to '–°–∫—Ä–∏–π', hide_free_task_path(@free_task), class: 'action', method: :put %>
    </p>
  <% end %>
</div>
