<div class="task">
  <h1><%= @task.label %></h1>

  <p>
    <%= admin_only do %>
      <%= link_to 'Редактирай', edit_task_path(@task), class: :action %>
    <% end %>

    <%= authenticated_only do %>
      <% if @incomplete_solution %>
        Предай решение: <code>vim-fmi put <%= @incomplete_solution.token %></code>
      <% else %>
        <%= link_to 'Предай решение', task_solutions_path(@task), {
          method: :post,
          class:  [:action, :primary],
        } %>
      <% end %>
    <% end %>
  </p>

  <% if admin? or @task.closed? %>
    <p><%= link_to 'Предадени решения', task_solutions_path(@task) %></p>
  <% end %>

  <% if @task.closed? %>
    <p class="closed">Срокът за предаване на решения е отминал</p>
  <% end %>

  <% if @completed_solutions %>
    <%# link_to 'Коментари към моето решение', @current_user_solution, class: [:action, :primary] %>

    <p>
      <h3>Твоите решения</h3>

      <ul>
      <% @completed_solutions.each do |solution| %>
        <li>
          <code><% VimKeylog.new(solution.script, solution.created_at).each do |key| %><% if key.size > 1 %><span class="special-key"><%= key %></span><% else %><%= key %><% end %><% end %></code>
        </li>
      <% end %>
      </ul>
    </p>
  <% end %>

  <dl>
    <dt>Краен срок:</dt>
    <dd><%= l @task.closes_at %></dd>

    <dt>Точки:</dt>
    <dd><%= @task.points %></dd>
  </dl>

  <p>
    <h3>Начално състояние</h3>
    <%= render 'shared/code', code: @task.input %>

    <h3>Крайно състояние</h3>
    <%= render 'shared/code', code: @task.output %>

    <% if @task.description? %>
      <p><%= @task.description %></p>
    <% end %>
  </p>
</div>
