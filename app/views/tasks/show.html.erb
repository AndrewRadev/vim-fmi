<div class="task">
  <h1><%= '‚úÖ ' if @task.completed_by?(current_user) %><%= @task.label %></h1>

  <p>
    <%= admin_only do %>
      <%= link_to '–†–µ–¥–∞–∫—Ç–∏—Ä–∞–π', edit_task_path(@task), class: :action %>
    <% end %>

    <%= authenticated_only do %>
      <% if @incomplete_solution %>
        –ü—Ä–µ–¥–∞–π —Ä–µ—à–µ–Ω–∏–µ: <code class="solution-token">vim-fmi put <%= @incomplete_solution.token %></code>

        <%= link_to 'üóëÔ∏è', task_solution_path(@task, @incomplete_solution), {
          method: :delete,
          class:  [:action],
        } %>
      <% else %>
        <%= link_to '–ü—Ä–µ–¥–∞–π —Ä–µ—à–µ–Ω–∏–µ', task_solutions_path(@task), {
          method: :post,
          class:  [:action, :primary],
        } %>
      <% end %>
    <% end %>
  </p>

  <% if admin? or @task.closed? %>
    <p><%= link_to '–î—Ä—É–≥–∏ —Ä–µ—à–µ–Ω–∏—è', task_solutions_path(@task) %></p>
  <% end %>

  <% if @task.closed? %>
    <p class="closed">–°—Ä–æ–∫—ä—Ç –∑–∞ –ø—Ä–µ–¥–∞–≤–∞–Ω–µ –Ω–∞ —Ä–µ—à–µ–Ω–∏—è –µ –æ—Ç–º–∏–Ω–∞–ª</p>
  <% end %>

  <dl>
    <dt>–ö—Ä–∞–µ–Ω —Å—Ä–æ–∫:</dt>
    <dd><%= l @task.closes_at %></dd>

    <dt>–¢–æ—á–∫–∏:</dt>
    <dd><%= @task.points %></dd>
  </dl>

  <p>
    <% if @task.description? %>
      <p><%=markup @task.description %></p>
    <% end %>

    <table class="input-output-table">
      <tr>
        <th>–ù–∞—á–∞–ª–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ</th>
        <th>–ö—Ä–∞–π–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ</th>
      </tr>

      <tr>
        <td><%= render 'shared/code', code: @task.input %></td>
        <td><%= render 'shared/code', code: @task.output %></td>
      </tr>
    </table>
  </p>

  <% if @completed_solutions %>
    <%# link_to '–ö–æ–º–µ–Ω—Ç–∞—Ä–∏ –∫—ä–º –º–æ–µ—Ç–æ —Ä–µ—à–µ–Ω–∏–µ', @current_user_solution, class: [:action, :primary] %>

    <p>
      <h3>–¢–≤–æ–∏—Ç–µ —Ä–µ—à–µ–Ω–∏—è</h3>

      <ul>
        <% @completed_solutions.each do |solution| %>
          <li>
            <code><%= render 'shared/script', script: solution.script %></code>
            <% admin_only do %>
              <ul>
                <% user_from_token = solution.user_from_token %>
                <li>User from token: <%= user_from_token.present? ? link_to(user_from_token.full_name, user_from_token) : 'N/A' %></li>
                <li>Meta: <code><%= solution.meta.to_json %></code></li>
              </ul>
            <% end %>
          </li>
        <% end %>
      </ul>
    </p>
  <% end %>
</div>
